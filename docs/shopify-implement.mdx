---
sidebar_position: 3
sidebar_label: Implement with Shopify
---

# Shopify

Greenleaze provides a custom shopify app so you can easily integrate GreenLeaze into your shopify store.
The integration is done in 3 steps :

- Install the custom app GreenLeaze on your shopify store ;
- Customize your store theme to display the greenleaze button ;
- Listen for events from Greenleaze to redirect the customer.

## Install the custom app GreenLeaze on your shopify store

This step is done by GreenLeaze. Please contact us to install the custom app on your shopify store. We will need your shopify store url (example.shopify.com). We will provide you with a link to install the app on all stores of the same organization.

You will then have to configure the app with the following informations :

- The URL of your Greenleaze Environment (https://staging.api.greenleaze.com for development or https://new.api.greenleaze.com for production) ;
- The Shopify API key and secret key ;
- The Shopify API password ;
- The secret key to use for the webhooks (optionnal) ;
- If you want Greenleaze to check the stock of the products before creating a draft order ;

## Add Product Metafields

You need to add a custom metafields to your store to disable GreenLeaze for some products :

- Go to your Shopify admin, click on Content then on MetaObjects ;
- Click on "Add a definition" then "Personalized data" and "products" then "Add a definition" ;
- Fill the form with the following values :
  - "Disable GreenLeaze for this product" ;
  - greenleaze.disabled ;
  - "Disable GreenLeaze for this product" ;
  - Type : True or False.

## Customizing your store theme

We recommand displaying the GreenLeaze widget on the product page and the cart page, the widget will allow your customers to choose the duration of the rental and see the monthly price.

In all cases you need to add the greenleaze-script.js file to your store in assets/greenleaze-script.js.

[Download greenleaze-script.js](./file/greenleaze-script.js)

Durations will be automatically fetched from the Shopify App.
You may edit the `var monthValues = [1, 12, 24, 36];` to set default durations in case of loading error.

### Display the GreenLeaze widget on the product page

1. Create a new snippet `greenleaze-product.liquid`, it will hold a button GreenLeaze.

The following code must be customized to fit your store design. For simplicity, all style are in the file.

[Download greenleaze-product.liquid](./file/greenleaze-product.liquid)

The button if display thanks to the following code :

```liquid
<div class="greenleaze-button greenleaze-button-product button" data-price="{{product.price}}" data-variant-id={{ product.selected_or_first_available_variant.id }}>
        Louer
</div>
```

You may need to edit the data-price attribute to correctly get the price of the product for your store. To change the price after render you must edit the data-price attribute then rerender the widget by doing one of the following :

- Call the event `greenleazePriceActualize` on window ;
- Call the function `addModalAndButtonPrice` ;
- Remove and re-add the button.

You may also edit the script in the file to listen for custom events to call the addModalAndButtonPrice function with a customer price.

2. Import the snippet in your product template `product.liquid` or file where you want to display the widget

```liquid
{% render 'greenleaze-product' %}
```

### Display the GreenLeaze widget on the cart page

1. Create a new snippet `greenleaze-cart.liquid`, it will hold a GreenLeaze button and modal to display the prices of each product in the cart. The following code must be customized to fit your store design.

[Download greenleaze-cart.liquid ](./file/greenleaze-cart.liquid)

You may need to edit the same values as for the product widget.
By default the modal gets the price from Shopify cart. You may edit the script to get the price from a custom source.

2. Import the snippet in your cart template `main-cart.liquid` or file where you want to display the widget

```liquid
{% render 'greenleaze-abonnement-cart' %}
```

3. Call rerender when the cart is updated

You can call the event `greenleazePriceActualize` on window when the cart is updated so the price is correctly displayed or you can edit the script to listen for the change event and call the `addModalAndButtonPriceCart` function. You may add a delay to avoid calling the rerender before the cart is updated.

```javascript
window.addEventListener("change", function (event) {
  setTimeout(() => addModalAndButtonPriceCart(), 1500);
});
```

### Display the GreenLeaze price on the collection page

1. Create a new snippet `greenleaze-product-preview.liquid`, it will hold the price of the product on the collection card.

[Download greenleaze-product-preview.liquid](./file/greenleaze-product-preview.liquid)

2. Import the snippet in your theme product-card.liquid file or other template where you want to display the price, just before the product price.

```liquid
{% render 'greenleaze-product-preview' %}
```

### Integrate with your existing tools

#### Retreive the orders

Greenleaze will automatically send the order created with the shopify to your shopify store. If you want the orders created on the Greenleaze dashboard you can use the following webhooks and configure them in the Greenleaze dashboard.

- Product webhook : `https://shopify.api.greenleaze.com/webhooks/search-product?shop=example.myshopify.com` (to be able to select a shopify product in the Greenleaze dashboard)
- Order confirmed webhook : `https://shopify.api.greenleaze.com/webhooks/validate-order?shop=example.myshopify.com` (only select Dashboard Greenleaze as source so you don't have duplicates)

For both webhooks the secret key is the same as the value you enter on the Shopify App settings page. Use a complex key.
